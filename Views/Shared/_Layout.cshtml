@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery

<!DOCTYPE html>
<html>
<head>
    <title>@ViewData["Title"] - VinylShop</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="~/css/shop.css" />
    <link rel="stylesheet" href="~/css/auth.css" />
</head>

<body>
    <header class="main-header">
        <div class="header-container">
            <a href="/Shop/Home" class="logo">
                <img src="~/img/logo.png" alt="Vinyl Place Logo">
                <span>VINYL SHOP</span>
            </a>

            <nav class="navigation">
                <a href="/Shop/Home">–ì–û–õ–û–í–ù–ê</a>
                <a href="/Shop/Albums/Albums">–ö–ê–¢–ê–õ–û–ì –ü–õ–ê–¢–Ü–í–û–ö</a>
                <a href="#">–î–û–°–¢–ê–í–ö–ê –¢–ê –û–ü–õ–ê–¢–ê</a>
                <a href="#">–°–¢–ê–¢–¢–Ü –¢–ê –û–ì–õ–Ø–î–ò</a>
            </nav>

            <a href="/Shop/Orders/Create" class="cart-button-link">
                <div class="cart-button">
                    <span class="cart-total">0 –≥—Ä–Ω.</span>
                    <span class="cart-icon">üõí</span>
                    <span class="cart-count">0</span>
                </div>
            </a>

            @if (User.Identity?.IsAuthenticated ?? false)
            {
                <div class="auth-button">
                    <a href="/Shop/Account/Profile">üë§ –ú—ñ–π –∫–∞–±—ñ–Ω–µ—Ç</a>
                    <form method="post" asp-page="/Account/Logout" asp-area="Shop">
                        <button type="submit" class="logout-button">üö™ –í–∏–π—Ç–∏</button>
                    </form>
                </div>
            }
            else
            {
                <div class="auth-button">
                    <a href="#" onclick="openAuthModal()">üë§ –û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</a>
                </div>
            }
        </div>
    </header>

    <main class="container">
        @RenderBody()
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ -->
    <div id="authModal" class="modal">
        <iframe id="authModalFrame" src="/Shop/Account/Login?returnUrl=@Context.Request.Path" class="modal-iframe"></iframe>
    </div>

    @RenderSection("Scripts", required: false)

    <script>
        function updateCartUI() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            let totalQty = 0;
            let totalPrice = 0;

            cart.forEach(item => {
                totalQty += parseInt(item.qty);
                totalPrice += item.qty * item.price;
            });

            const countEl = document.querySelector('.cart-count');
            const totalEl = document.querySelector('.cart-total');

            if (countEl && totalEl) {
                countEl.textContent = totalQty;
                totalEl.textContent = `${totalPrice.toFixed(2)} –≥—Ä–Ω.`;
            }
        }

        document.addEventListener('DOMContentLoaded', updateCartUI);

        function openAuthModal() {
            const modal = document.getElementById("authModal");
            if (modal) {
                modal.style.display = "block";
            }
        }

        function closeAuthModal() {
            const modal = document.getElementById("authModal");
            if (modal) {
                modal.style.display = "none";
            }
        }

        window.addEventListener("message", function (event) {
            if (event.data?.action === "loginSuccess") {
                closeAuthModal();
                location.reload();
            }

            if (event.data?.action === "closeModal") {
                closeAuthModal();
            }
        });
    </script>

</body>
</html>
